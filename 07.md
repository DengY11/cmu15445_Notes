# CMU15445 07
## Hash Tables
### 1.Data Structrues
DBMS使用各种数据结构来管理系统内部的不同部分。例如：
- **内部元数据（Internal Meta-Data）**：跟踪数据库和系统状态的信息（如页面表、页面目录）。
- **核心数据存储（Core Data Storage）**：用于存储数据库中的元组。
- **临时数据结构（Temporary Data Structures）**：在处理查询时动态构建，以加速执行（如用于连接的哈希表）。
- **表索引（Table Indices）**：辅助数据结构，便于查找特定的元组。

设计数据结构时需要考虑两方面：
- **数据组织（Data Organization）**：确定如何布局内存以及在数据结构中存储哪些信息以支持高效访问。
- **并发性（Concurrency）**：确保多个线程访问数据结构时不会出问题，保证数据的正确性和完整性。

### 2. 哈希表（Hash Table）
哈希表实现了关联数组抽象数据类型，将键映射到值。平均情况下，哈希表提供**O(1)**的操作复杂度（**最坏情况下为O(n)**）和O(n)的存储复杂度。

<img src="./07 pictrue/1.png" alt="图片描述" width="500" height="290">

*不同于算法竞赛,实际生产中需要关注复杂度的**常数***。

哈希表的**实现**包括两部分：

- **哈希函数（Hash Function）**：将大键空间映射到较小的域，用于计算桶或槽的索引。需要在快速执行和低碰撞率之间进行权衡。
- **哈希方案（Hashing Scheme）**：处理哈希冲突的方式。需要在减少碰撞的哈希表大小和处理冲突的额外指令之间进行权衡。

### 3. 哈希函数（Hash Functions）
哈希函数接收**任意键作为输入**，**返回该键的整数表示**（即“哈希”）。输出是确定性的，即**相同的键总是生成相同的哈希值**。DBMS不需要使用**加密安全**的哈希函数(比如SHA-256)，因为不需要保护键的内容。我们只关心哈希函数的速度和碰撞率。当前最先进的哈希函数是Facebook的**XXHash3**。
<img src="./07 pictrue/2.png" alt="图片描述" width="500" height="290">

### 4. 静态哈希方案（Static Hashing Schemes）
静态哈希方案中，哈希表的大小是固定的。如果哈希表存储空间不足，必须重新构建一个更大的哈希表，这是非常"*昂贵* "的操作。通常新哈希表的大小是原哈希表的两倍。

#### 4.1 线性探测哈希（Linear Probe Hashing）
最基本且通常最快的哈希方案。使用循环缓冲区数组槽。当发生碰撞时，线性搜索相邻槽直到找到一个空槽。查找时，从键哈希到的槽开始，线性搜索直到找到所需的条目或达到空槽。
<img src="./07 pictrue/3.png" alt="图片描述" width="500" height="290">
*具体操作方法比较繁琐，这里不过多展示，课程ppt非常详细*

#### 4.2 布谷鸟哈希（Cuckoo Hashing）
使用多个哈希表和不同的哈希函数。插入时，检查这个表的每个哈希函数映射到的位置是否是空的，如果有多个空的，则选择其中任意一个插入。如果一个空槽都没有，则需要将上一个有多个空槽的key映射到其他空的位置，这可能会引发 ***链式反应***。 布谷鸟哈希保证O(1)的查找和删除，但插入可能更昂贵。
<img src="./07 pictrue/4.png" alt="图片描述" width="500" height="290">
*图上的这种情况是两个哈希函数都出现了冲突，这个时候需要将B映射到另一个哈希函数的位置*

### 5. 动态哈希方案（Dynamic Hashing Schemes）
动态哈希方案能够按需调整哈希表大小，而无需重建整个表。

#### 5.1 链式哈希（Chained Hashing）
最常见的动态哈希方案。为哈希表中的每个槽维护一个桶的链表。将键插入到哈希到同一槽的链表中。
<img src="./07 pictrue/5.png" alt="图片描述" width="500" height="290">
#### 5.2 可扩展哈希（Extendible Hashing）
改进的链式哈希，通过拆分桶而不是让链表无限增长。哈希表的多个槽可以指向同一个桶链。
<img src="./07 pictrue/6.png" alt="图片描述" width="500" height="290">
#### 5.3 线性哈希（Linear Hashing）
在桶溢出时不立即拆分，而是维护一个指向下一个要拆分的桶的指针。无论指针指向哪个桶，只要桶溢出就拆分。
<img src="./07 pictrue/7.png" alt="图片描述" width="500" height="290">

### 结论
哈希表在DBMS中是关键的数据结构，用于**快速查找**和**存储数据**。通过选择合适的**哈希函数**和**哈希方案**，可以优化哈希表的性能，减少碰撞，确保高效的数据访问。不同的哈希方案适用于不同的场景，静态哈希适用于已知数据量的情况，而动态哈希则适用于数据量变化较大的情况。