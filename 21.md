# CMU15445 21
## 分布式数据库简介
### 1 分布式DBMS
分布式DBMS（Distributed Database Management System）将一个逻辑数据库划分到多个物理资源上。应用程序通常不会察觉数据已分布在不同的硬件上。系统依赖于单节点DBMS中的技术和算法来支持分布式环境中的事务处理和查询执行。设计分布式DBMS的一个重要目标是**容错**（即避免单个节点故障导致整个系统崩溃）。

分布式DBMS和并行DBMS的区别：
- **并行数据库**：
  - 节点彼此物理上靠近。
  - 节点通过高速局域网（LAN）连接（通信快速且可靠）。
  - 节点之间的通信成本被认为很小，因此在设计内部协议时，不必过多担心节点崩溃或数据包丢失。
- **分布式数据库**：
  - 节点可能相距较远。
  - 节点通过可能缓慢且不可靠的公共网络连接。
  - 通信成本和连接问题不可忽视（即节点可能崩溃，数据包可能丢失）。

### 2 系统架构
DBMS的系统架构定义了哪些共享资源对CPU可直接访问。这决定了CPU如何相互协调，以及它们从哪里检索和存储数据库中的对象。  
单节点DBMS使用的架构称为**共享一切架构**，其中单个节点在本地CPU上执行任务，拥有自己的内存地址空间和磁盘。

#### 共享内存
在共享内存架构中，所有CPU通过高速互连访问公共内存地址空间，且共享相同的磁盘。然而，这种架构很少在DBMS中使用，主要因为它由操作系统或内核级别提供，并且内存范围可以被多个进程修改，这会导致问题。

<img src="./21 pictrue/1.png" alt="" width="600" height="350">

#### 共享磁盘
在共享磁盘架构中，所有CPU通过互连可以直接读写单个逻辑磁盘，但每个节点有自己的私有内存。节点之间通过消息传递来了解彼此的当前状态，因为内存是本地的，修改数据后必须将变更告知其他节点。这种架构在云数据库中较为常见。

#### 无共享架构
在无共享环境中，每个节点都有自己的CPU、内存和磁盘，节点之间仅通过网络通信。无共享架构在云存储平台崛起之前曾被认为是构建分布式DBMS的正确方式。这种架构的优点是可以获得更高的性能，但难点在于增加容量时需要移动数据，并且确保一致性变得困难。

<img src="./21 pictrue/2.png" alt="" width="600" height="250">

### 3 设计问题
分布式DBMS旨在保持数据透明性，用户无需知道数据的物理位置或表是如何分区或复制的。设计时必须解决的关键问题包括：
- 应用程序如何找到数据？
- 如何执行分布式数据上的查询？查询应该被推送到数据所在的节点，还是将数据汇集到一个位置执行查询？
- DBMS如何确保正确性？

此外，设计中还需要决定节点在集群中的交互方式，常见的选项包括**同构节点**和**异构节点**。  
- **同构节点**：集群中的每个节点可以执行相同的任务，这非常适合无共享架构。  
- **异构节点**：节点分配特定任务，需要相互通信来完成给定任务。

### 4 分区方案
分布式系统必须将数据库分区到多个资源上，包括磁盘、节点和处理器。NoSQL系统中有时称之为**分片**（Sharding）。同时，分区的设计目标是尽量让每个事务只访问一个节点上的数据，而不需要跨越多个节点访问数据。这样做的目的是为了避免在多个节点之间进行复杂的协调，从而提高系统性能和效率。
分区的常见方法包括：
- **垂直分区**：将表的属性（列）分为多个分区。
- **水平分区**：将表的记录（行）分为互不重叠的子集。

<img src="./21 pictrue/3.png" alt="" width="600" height="300">

#### 实现方式
最简单的分区方式是**简单数据分区**，即每个节点存储一个表。这种方法易于实现，但不具备扩展性。常见的水平分区方式是使用哈希、数据范围或谓词来决定数据存储的位置，**一致性哈希**用于解决节点增减时大量数据重分配的问题。

### 5 分布式并发控制

<img src="./21 pictrue/4.png" alt="" width="600" height="350">

分布式事务访问一个或多个分区的数据，这需要昂贵的协调。系统中有两种主要的协调方式：
- **集中式协调器**：充当全局“交通警察”，协调所有行为。
- **去中心化协调器**：节点自我组织，客户端直接与其中一个分区通信。这个“主分区”负责与其他分区通信并执行提交操作。

集中式协调可以更好地处理锁定和死锁问题，而去中心化方法虽然去除了单点瓶颈，但在处理分布式二阶段锁定协议时较为复杂。
